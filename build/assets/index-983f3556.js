import{r as n,j as e,F as C}from"./vendor-0c76c893.js";import{p as D,a as M,o as T,I as k,M as g,T as B,l as I,S as P,q as U,E as W,W as z,r as G,F as N,G as O}from"./index-8d41848f.js";import{g as _}from"./get-method-obstaing-c0726de9.js";const q=async(r,u,a,m,s)=>{a(!0);const c=D(r);try{await u({...c,formId:s}),a(!1),m({completed:!0})}catch(p){a(!1),M.evokePopUpMessage({message:`${p}`,type:"failure",time:3e4})}},w=({model:r,getForm:u,successMessage:a,outerForm:m,isAvailableToSend:s=!0,repeatable:c=!0,formId:p,isSpecialField:F})=>{var h;const{data:o,completed:f}=r.selectors.useForm(),[d,x]=n.useState(!1),[t,i]=n.useState(null),[j,S]=n.useState({}),l=(f||!s)??!1;return n.useEffect(()=>{o&&i(m??u(o))},[o]),n.useEffect(()=>{F&&t&&o&&S(_(t.data))},[t]),!t||!i?e.jsx(T,{}):e.jsxs(e.Fragment,{children:[e.jsx(k,{...t,collapsed:l&&!c,setData:i,specialFieldsName:j}),e.jsx(g,{title:"Информация по заявке",type:"info",icon:e.jsx(C,{}),visible:l&&!!a,children:a}),(o==null?void 0:o.last_update)&&e.jsxs(B,{size:5,children:["Дата последней отправки: ",I(o.last_update)]}),e.jsx(P,{text:s?"Отправить":"Отправлено",action:()=>q(t,r.effects.postFormFx,x,r.events.changeCompleted,p),isLoading:d,completed:f,setCompleted:E=>r.events.changeCompleted({completed:E}),buttonSuccessText:"Отправлено",repeatable:c,isDone:l&&!c,isActive:U(t,Object.values(j))&&(((h=t.optionalCheckbox)==null?void 0:h.value)??!0),popUpFailureMessage:l?"Форма отправлена":"Для отправки формы необходимо, чтобы все поля были заполнены",popUpSuccessMessage:"Данные формы успешно отправлены"})]})},H=({model:r,getForm:u,successMessage:a,goBack:m,pageAvailability:s,isAvailableToSend:c=!0,repeatable:p=!0,formId:F,isSpecialField:o=!1})=>{const{data:f,error:d}=r.selectors.useForm(),[x,t]=n.useState(null);return(!!s&&!(s!=null&&s.isAvailable))??!1?e.jsx(W,{text:(s==null?void 0:s.text)??"Вам не доступен этот раздел"}):(n.useEffect(()=>{f&&t(u(f))},[f]),e.jsx(z,{load:()=>r.effects.getFormFx(),error:d,data:x,children:e.jsx(G,{children:!!x&&!!t&&e.jsxs(N,{children:[e.jsx(O,{text:m,visible:!!m}),e.jsx(w,{model:r,successMessage:a,isAvailableToSend:c,repeatable:p,getForm:u,outerForm:x,formId:F,isSpecialField:o})]})})}))};export{H as T};
